#!/usr/bin/env ruby

require 'pathname'
bin_file = Pathname.new(__FILE__).realpath
$:.unshift File.expand_path('../../lib', bin_file)
require 'blast_commander'

b = BlastCommander::Blast.new './query.fsa'

def refs(references)
  references.collect do |ref|
    [ref.authors,
     ref.journal,
     ref.description].join(' | ')
  end.join(" // ")
end

puts "SEQ ID\tACC ID\tHITDEF\tHITSEQ\tHITLEN\tQCOV\tMAXIDENT\tEVAL\tREFS"

b.hits.each do |hit|
 puts [hit.qseqid,
       hit.saccver,
       hit.stitle,
       hit.sseq,
       hit.slen,
       hit.qcovs,
       hit.pident,
       hit.evalue,
       refs(hit.references)].join("\t")
end


# 
# 
# <% @hits.each do |hit| %>
#   <tr class="hit">
#     <td class="sequence-id"><%= hit.qseqid %></td>
#     <td class="accession-id">
#       <input type="checkbox" name="export_hits[]" value="<%= hit.saccver %>" />
#       <%= hit.saccver %>
#     </td>
#     <td class="hit-definition"><%= hit.stitle %></td>
#     <td class="hit-sequence"><%= hit.sseq %></td>
#     <td class="hit-length"><%= hit.slen %></td>
#     <td class="query-coverage"><%= hit.qcovs %></td>
#     <td class="max-ident"><%= hit.pident %></td>
#     <td class="hit-evalue"><%= hit.evalue %></td> 
#     <td class="reference">
#       <% hit.references.each do |ref| %>
#         <p>
#           <b><%= ref.authors %></b><br />
#           <i><%= ref.journal %></i><br />
#           <%= ref.description %>
#         </p>
#       <% end %>
#     </td>
#   </tr>
# <% end %>
